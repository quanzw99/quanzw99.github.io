<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Paper Reading 1 - Intersection Prediction for Accelerated GPU Ray Tracing | Quanzw's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=G-PH7R3FX4D4" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PH7R3FX4D4');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.1.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Paper Reading 1 - Intersection Prediction for Accelerated GPU Ray Tracing</h1><a id="logo" href="/.">Quanzw's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/tags/"><i class="fa fa-tag"> tag</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Paper Reading 1 - Intersection Prediction for Accelerated GPU Ray Tracing</h1><div class="post-meta">2023-07-24<span> | </span><span class="category"><a href="/categories/Reading/">Reading</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#INTRODUCTION"><span class="toc-number">1.</span> <span class="toc-text">INTRODUCTION</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BACKGROUND-amp-MOTIVATION"><span class="toc-number">2.</span> <span class="toc-text">BACKGROUND &amp; MOTIVATION</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU-Architecture"><span class="toc-number">2.1.</span> <span class="toc-text">GPU Architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ray-Tracing"><span class="toc-number">2.2.</span> <span class="toc-text">Ray Tracing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ambient-Occlusion"><span class="toc-number">2.3.</span> <span class="toc-text">Ambient Occlusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ray-Traversal-Algorithm"><span class="toc-number">2.4.</span> <span class="toc-text">Ray Traversal Algorithm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Accelerating-Ray-Tracing"><span class="toc-number">2.5.</span> <span class="toc-text">Accelerating Ray Tracing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAY-INTERSRCTION-PREDICTOR-ALGORITHM"><span class="toc-number">3.</span> <span class="toc-text">RAY INTERSRCTION PREDICTOR ALGORITHM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PROPOSED-ARCHITECTURE"><span class="toc-number">4.</span> <span class="toc-text">PROPOSED ARCHITECTURE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Predictor-Table-Architecture"><span class="toc-number">4.1.</span> <span class="toc-text">Predictor Table Architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashing"><span class="toc-number">4.2.</span> <span class="toc-text">Hashing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Grid-Spherical"><span class="toc-number">4.2.1.</span> <span class="toc-text">Grid Spherical</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Two-point"><span class="toc-number">4.2.2.</span> <span class="toc-text">Two point</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Go-Up-Level"><span class="toc-number">4.3.</span> <span class="toc-text">Go Up Level</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Warp-Repacking"><span class="toc-number">4.4.</span> <span class="toc-text">Warp Repacking</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Implementation"><span class="toc-number">4.4.1.</span> <span class="toc-text">Implementation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Additional-Warps"><span class="toc-number">4.4.2.</span> <span class="toc-text">Additional Warps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hardware-Implementation"><span class="toc-number">4.5.</span> <span class="toc-text">Hardware Implementation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#METHODOLOGY"><span class="toc-number">5.</span> <span class="toc-text">METHODOLOGY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ray-Tracing-Unit"><span class="toc-number">5.1.</span> <span class="toc-text">Ray Tracing Unit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Interface"><span class="toc-number">5.1.1.</span> <span class="toc-text">Interface</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Traversal-Unit"><span class="toc-number">5.1.2.</span> <span class="toc-text">Traversal Unit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Intersection-Unit"><span class="toc-number">5.1.3.</span> <span class="toc-text">Intersection Unit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Memory-Interface"><span class="toc-number">5.1.4.</span> <span class="toc-text">Memory Interface</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Latency"><span class="toc-number">5.1.5.</span> <span class="toc-text">Latency</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Correlation"><span class="toc-number">5.1.6.</span> <span class="toc-text">Correlation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Simulation"><span class="toc-number">5.2.</span> <span class="toc-text">Simulation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RESULTS"><span class="toc-number">6.</span> <span class="toc-text">RESULTS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RELATED-WORKS"><span class="toc-number">7.</span> <span class="toc-text">RELATED WORKS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CONCLUSION"><span class="toc-number">8.</span> <span class="toc-text">CONCLUSION</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REFERENCES"><span class="toc-number">9.</span> <span class="toc-text">REFERENCES</span></a></li></ol></div></div><div class="post-content"><p>Tor Aamodt在<a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~aamodt/projects/graphics/">个人主页</a>中描述了研究<code>Graphics Hardware</code>的动机。此外，在<a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~aamodt/publications/">Publication页面</a>分享了<a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~aamodt/publications/papers/liu.micro2021.pdf">本文</a>的<a target="_blank" rel="noopener" href="https://github.com/ubc-aamodt-group/ray-intersection-predictor">code</a>和<a target="_blank" rel="noopener" href="http://www.lufei.ca/files/MicroVideo.mp4">video</a>。<span id="more"></span></p>
<p><strong><em>ABSTRACT</em></strong></p>
<p>多年来，<code>ray tracing</code>被用于制作逼真的电影图像，而更快的<code>raster-based</code>基于光栅化的着色技术一直是视频游戏的首选，以满足实时需求。然而，最近的<code>GPUs</code>集成了为光追设计的硬件加速器单元。这些加速器单元针对遍历层次化树状数据结构的过程，这种树状结构用于测试<code>ray-object intersection</code>光线和物体是否相交。在这种数据结构中，朝着相似路径的不同光线会执行很多冗余的<code>ray-box intersection</code>光-盒相交测试。我们提出了一种<code>ray intersection predictor</code>光线相交预测器，在此过程中可以推测性地省略冗余操作，并直接测试光线可能相交的原始物体。我们的<code>predictor</code>的一个关键点是包含了<code>identifying hash function</code>识别哈希函数，这些函数能够保留足够的空间信息，以识别冗余的遍历操作。我们将探讨如何将光线预测策略集成到现有的<code>GPU</code>管线上，并通过预测树上更高层次的节点（靠近根节点的节点）以及更低成本的更谨慎的方式重新组合和调度遍历操作，来提高<code>predictor</code>的效率。在搭载光追加速器单元的移动类<code>GPU</code>上，每个<code>streaming multiprocessor</code>流处理器增加一个5.5KB的预测器后，对于<code>ambient occlusion</code>环境光遮蔽工作负载，<code>geometric mean</code>几何平均提高了26%。</p>
<h2 id="INTRODUCTION"><a href="#INTRODUCTION" class="headerlink" title="INTRODUCTION"></a>INTRODUCTION</h2><p>实时光追有望改变视频游戏的格局。拥有硬件加速的光追功能的<code>GPU</code>使开发者能在计算预算内实现更令人信服的视觉效果。光追通过物理准确的渲染算法产生逼真的图像。常见的<code>Whitted-style</code>光追将光模拟为从相机发出并与环境进行交互的光线。这些光线穿过场景，并在与物体和光源相交时积累颜色。因此，<u>光追可以呈现出光栅化无法实现的视觉效果。</u>例如，光栅化会忽略相机中不可见的物体，因此无法跟踪被忽略对象的间接照明效果。</p>
<p><strong>光追具有丰富的<code>parallelism</code>并行性<sup>1</sup></strong>，非常适合<code>Single Instruction Multiple Data</code><strong>单指令多数据<sup>2</sup></strong>（SIMD）执行。现代光追使用<code>acceleration structures</code>加速结构(AS)，例如<code>the Bounding Volume Hierarchy</code><strong>包围体层次结构<sup>3</sup></strong>（BVM），来组织场景数据以提高搜索光线相交的效率。对于每条光线，都必须执行<code>AS</code>遍历，而光线在场景中的随机散射会导致光线的相交点变得不一致，即相交的物体可能相距较远。因此，简单的光追实现在<code>power</code>功耗和<code>memory utilization</code>内存利用方面效率都不高。例如，不一致的光线会导致计算开销和内存分散，尤其是在<code>SIMD</code>架构中。这些不一致还会对内存层次结构造成压力，<strong>争夺内存带宽<sup>4</sup></strong>并导致<strong>缓存缓冲<sup>5</sup></strong>。然而，就是不一致的光线产生了最令人印象深刻的视觉效果，从而在视觉质量和计算负载之间产生竞争。</p>
<p><code>Ambient Occlusion</code>环境光遮挡（AO）是其中一个受益于光追加速的效果。<code>AO rays</code>AO光线也被称为<code>occlusion rays</code><strong>遮挡光线<sup>6</sup></strong>，用于测试是否与任何物体相交，而不需要找到最近的相交点。遮挡光线很常见且对性能至关重要。这在现代光追API中支持跳过最近最近命中着色器执行功能中得到证明。基础渲染可以通过光栅化高效执行，然后通过光追来增强以保持实时性能。许多商业游戏都通过光追拓展现有的光栅化方法；硬件也应该模拟这种组合。</p>
<p><img src="Figure1.png" alt=""></p>
<p><code>AO</code>的工作负载具有高计算需求，因为每个像素点都必须使用多条光线进行采样。此外，<code>AO</code>光线通常很短并且在他们访问的<code>AS</code>中存在显著的冗余。<code>Figure 1</code>展示了在<code>AO</code>的工作负载中，对于每个单独的光线，内存访问类型的分布情况，且这个分布是在七个场景下求平均得到的。<code>Figure 1(left)</code>中<code>Repeated BVM Node Accesses</code>占比88%。由于他们不参与最终光线的相交计算，因此有机会通过预测遍历并跳过他们来提高性能。简单地使用缓存来加速计算是不够的，为了实现类似<code>Figure 1(right)</code>看到的相似的加速效果，需要一个非常大的缓存结构，因为<code>AO</code>计算所需的<code>working set</code>很大。</p>
<p>之前的研究通过专用的硬件加速器来加速光追中的<code>AS</code>遍历和光线相交测试。然而这些加速器都是作为独立的加速器设计的，他们与<code>GPU</code>互相孤立。另一个研究领域探索了通过减少光线不一致或者创造更适合<code>GPU</code>的<code>SIMD</code>特性的<code>optimized AS</code>来高效利用<code>GPU</code>硬件的方法。然而，目前的光追性能仍不足以实现3A游戏的实时渲染。</p>
<p>我们提出了一种光线相交预测器，已利用遮挡光线遍历时的冗余和提高内存层次结构的利用。与以前在光栅图形学中帧间缓存不同，我们的预测器专注于当前帧中的冗余。我们利用了<code>AO</code>的特性，他们只在意是否相交而非最近的相交。预测器使用之前相似光线的<code>AS</code>遍历结果来进行预测，通过哈希来确定相似光线。成功的预测可能会直接找到叶子节点、跳过整个遍历过程。错误的预测可能会从根节点从更新开始。在预测后，我们提出的预测器对当前正在遍历<code>AS</code>的<strong><code>warps</code><sup>7</sup></strong>线程束进行重新打包，以提高<strong><code>SIMT</code><sup>8</sup></strong>的效率。</p>
<p><img src="Figure2.png" alt=""></p>
<p><code>Figure 2</code>展示了限制性研究的结果，评估了光线预测的潜力（详见6.3节）。结果显示，使用一个容量为5.5KB的预测器，可以预测38%的光线，这个预测器被理想化为只能执行<code>oracle lookups</code>神谕式的查找，即始终能够识别光线与表中条目的交点，如果这个交点存在的话（Potential Prediction(5.5KB)）。相比之下，我们提出的可实现的5.5KB的光线预测器（详见第4节）实现了26%的加速并且能够识别27%的光线相交(Proposed Predictor)。</p>
<p>为了评估我们的预测器，我们建立了一个基准的光追单元，用于加速在现代<code>GPU</code>中进行的光追，类似于<code>NVIDIA RT Core</code>。我们展示了我们的光追单元在独立运行时的周期级模拟结果与<code>NVIDIA RT Core</code>的性能之间的相关性。建模带有光追单元的<code>GPU</code>可以支持实现光栅化和光追的实际工作负载。我们的模拟器可以在<code>github</code>上获得，地址为<a target="_blank" rel="noopener" href="https://github.com/ubc-aamodt-group/ray-intersection-predictor">https://github.com/ubc-aamodt-group/ray-intersection-predictor</a> 。</p>
<p>本文贡献如下：</p>
<ul>
<li>我们提出并评估了<code>a ray intersection predictor module</code>，它在<code>BVH</code>树遍历的过程中，预测性的跳过了一些<code>ray-box intersection</code>，直接访问<code>AS</code>中深层的节点。</li>
<li>我们在预测器中引入了<code>warp</code>线程束重新打包的拓展，目标是使得线程束内部的线程有类似的工作分配，即在执行完成时的工作量相似，并创建内存访问合并的机会。</li>
<li>我们在周期级<code>GPU</code>模拟器<code>GPGPU-sim</code>中建模了详细的基准光追单元，并于<code>NVIDIA RTX 2080Ti</code>进行了相关性分析。</li>
</ul>
<p>第2节介绍了光追的相关背景信息。第3、4节描述了我们提出的光线相交预测器。第5节详细介绍了我们的方法，包括基准光追单元的描述，随后在第6节给出实验结果，在第7节介绍了相关工作。</p>
<p><strong><em>Notes:</em></strong></p>
<ol>
<li>“光追具有丰富的并行性”是因为在光追算法中，每条光线的计算是互相独立的，没有依赖关系，这意味着可以同时处理多条光线。</li>
<li>“单指令多数据”是一种并行计算模型，它是指一条指令同时作用于多个数据元素。在这种模型中，多个处理单元同时执行相同的指令，但每个处理单元的数据可以是不同的。</li>
<li>“包围体层次结构”是一种树状结构，以提高光线和物体相交计算的效率。思路是将场景中的物体组织成了一系列的层次结构。具体来说，它采用了分治的想法，将场景递归地划分为了一系列<code>Bounding Volume</code>包围体，每个包围体是一个<code>Bounding Box</code>边界盒，它包含了场景中的若干物体。我们可以先测试光线是否与包围体是否相交：如果不相交，就跳过这个包围体内部所有的物体，从而节省了计算时间；如果相交，就进入这个包围体的子包围体重复以上步骤。</li>
<li>“争夺内存带宽”：内存带宽是指计算机系统在单个时间点能从内存读取或者写入数据的能力，当多个光线同时请求读取或者写入数据时，会产生竞争，降低内存访问效率。</li>
<li>“缓存缓冲”：缓存是位于CPU和主内存之间的高速存储器，用于加速数据的访问。当不一致的光线访问的数据不在缓存中时，将频繁地将数据加载到缓存中，从而导致缓存缓冲。</li>
<li>“遮挡光线”：这种光线并不关心找到最近的交点，而是测试光线是否与任何物体相交。它们用于确定场景中的阴影强度，即在某个点周围的环境中，有多少光线被遮挡，从而影响该点的明暗程度。</li>
<li>“warps”: 线程束是一组并行执行的线程。在<code>GPU</code>中，线程被组织成一组线程束，并且这些线程在同一时间周期内执行相同的指令。引入线程束的目的是为了在<code>GPU</code>中实现高效的并行计算和资源管理，以便更好地利用硬件资源并提供更高的性能。</li>
<li>“SIMT”: Single Instruction, Multiple Threads. 是一种并行计算模型。在这种模型中多个线程执行相同的指令，但是可能处理不同的数据。</li>
</ol>
<h2 id="BACKGROUND-amp-MOTIVATION"><a href="#BACKGROUND-amp-MOTIVATION" class="headerlink" title="BACKGROUND & MOTIVATION"></a>BACKGROUND &amp; MOTIVATION</h2><p>本节概述了<code>GPU</code>架构和光追。我们通过描述<code>ray traced ambient occlusion</code>光追环境光遮挡面临的挑战来阐述我们研究预测器的动机。</p>
<h3 id="GPU-Architecture"><a href="#GPU-Architecture" class="headerlink" title="GPU Architecture"></a>GPU Architecture</h3><p><img src="Figure3.png" alt=""></p>
<p><code>GPU</code>是由许多<code>streaming multiprocessors</code>流式多处理器（SMs）组成的大规模并行处理器。<code>Figure 3</code>显示多个<code>warps</code>线程束可以在一个单独的<code>SM</code>上执行。每个线程束由32个线程组成，这些线程以<code>lockstep</code>锁步或者<code>SIMT</code>单指令多线程的方式执行。<code>Warp schedulers</code>线程束调度器在<code>SM</code>中分发线程束，以及与内存相关的单元，例如<code>load/store unit</code>加载/存储单元（LDST），<code>L1 cache/shared memory</code>L1缓存/共享内存和<code>register file</code>寄存器文件。多个<code>SM</code>组成了一个<code>cluster</code>集群，每个<code>cluster</code>通过<code>interconnect</code>连接到<code>memory hierachy</code>内存层次结构。</p>
<p><code>RT Cores</code>是<code>NVIDIA GPUs</code>中用于光追的专用单元，但<code>NVIDIA</code>并未提供其实现细节。因此，本文中建模了我们自己的光追加速器，称为<code>RT unit</code>，详见5.1节。</p>
<h3 id="Ray-Tracing"><a href="#Ray-Tracing" class="headerlink" title="Ray Tracing"></a>Ray Tracing</h3><p>光追通过追踪场景中的光线来模拟全局光照效果，每<code>pixel</code>像素追踪的光线数和图像中的像素数量决定了渲染质量。例如对于一个<code>1024*1024</code>的图像，每个像素四个<code>ray samples per pixel</code>光线样本（SSP），需要追踪超过四百万条光线。一个简单的实现需要进行超过一万亿次相交测试才能渲染像<code>Crytek Sponza</code>这样有242K个三角形的场景。因此，<code>primitives</code>原始物体们通常被组织成<code>Acceleration structure</code>加速结构（AS），详见2.4节。光线遍历<code>AS</code>以优化相交测试。对于实时光追应用，一种高效的硬件实现<code>AS</code>遍历至关重要。</p>
<p>光线在数学上被描述为具有起点，方向和长度的射线，表示为<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.491ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 3310.9 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mo" transform="translate(707.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1707.4,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2290.7,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(2790.9,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container>。虽然光线们在<code>AS</code>中是逐个遍历的，但是具有相似<code>origins</code>起点（o）和<code>directions</code>方向（d）在<code>AS</code>中走的路径相似。对于这些光线，我们可以记忆遍历过程，并且优化帧中未来的光线。这种记忆化可以使得<code>occlusion rays</code>遮挡光线（如<code>AO</code>和<code>shadow rays</code>）受益，因为一旦找到一个第一个交点，搜索就会终止，就有可能跳过整个遍历过程。</p>
<h3 id="Ambient-Occlusion"><a href="#Ambient-Occlusion" class="headerlink" title="Ambient Occlusion"></a>Ambient Occlusion</h3><p><code>Ambient lighting</code>环境光照是场景中基本水平的照明，通常情况下被艺术家们近似地设定为一个常量值。<code>Ambient occlusion</code>环境光遮挡是一种视觉效果，其中<code>crevices</code>罅隙/凹槽会因为接受较少的环境光而显得暗。在光追过程中，为了计算环境光遮挡，会追踪许多短光线，这些光线从感兴趣的点（通常是场景中的某个表面点）出发，覆盖一个半球面。与其他光线不同，环境遮挡光线不需要最近的交点。在<code>AO</code>计算中，任何<code>ray-object intersection</code>都意味着该点的一些环境光被遮挡了。与物体相交的光线比例代表了被遮挡的环境光的数量。</p>
<p>这种全局环境光遮挡无法在基于光栅化的图形学中准确实现，因为它需要全局信息。相反，<code>screen-space AO</code>屏幕空间环境光遮挡在基于光栅化的图形学中可用，但因为采样在物体后面或者在屏幕之外等基本问题会导致结果较差。在光追中，全局<code>AO</code>的计算成本高，因为需要计算大量光线才能达到高质量的结果。</p>
<h3 id="Ray-Traversal-Algorithm"><a href="#Ray-Traversal-Algorithm" class="headerlink" title="Ray Traversal Algorithm"></a>Ray Traversal Algorithm</h3><p><img src="Algo1.png" alt=""></p>
<p><code>AS</code>可以减少寻找交点所需的<code>ray-primitive test</code>次数，<code>Bounding Volume Hierarchy</code>包围体层次结构（BVH）是当前光追使用的标准<code>AS</code>。<code>BVM</code>树通过将<code>primitives</code>包含在叶子节点中，并递归地用较大的<code>axis-aligned bounding boxes</code>轴对齐包围盒（AABBs）包围低层次的<code>AABBs</code>。如果一条光线没有与某个非叶子节点相交，那它也不会与这个非叶子节点的子节点相交。这种属性将焦点测试的时间复杂度从线性降低到对数的，使得<code>BVH</code>对实时光追的性能至关重要。</p>
<p><code>BVH</code>遍历算法在软件中的实现是一个<code>while-while</code>循环，在<code>Algorithm 1</code>中描述了其用于遮挡光线的情况。外层<code>while</code>循环迭代直到光线完成遍历。内层<code>while</code>对<code>BVH</code>进行<code>depth-first traversal</code>深度优先遍历。深度优先遍历通常需要使用每个线程的<code>traversal stack</code>遍历栈（tStack），或者针对二叉树可能使用<code>bit trail</code>。如果第一个内层<code>while</code>达到叶子节点，那么第二个内部<code>while</code>循环将测试光线与<code>primitives</code>的相交。遍历将继续，知道所有的光线与<code>primitives</code>的相交点都被识别，或者对于遮挡光线而言，只需要找到任意相交。如果没有<code>ray-primitive intersection</code>出现，我们认为光线与场景没有相交。更多的光追背景知识，推荐去看<a target="_blank" rel="noopener" href="https://raytracing.github.io/books/RayTracingInOneWeekend.html">Ray Tracing in One Weekend</a>。</p>
<p>为了在遍历过程中提高效率，光线首先访问距离光线起点较近的子节点。然而，由于子节点可能重叠，所以第一个相交点可能并不是最近的相交点（<i>注：例如两个primitive非常接近或者部分重叠时，当光线遍历<code>BVH</code>时，如果子节点的边界体积重叠，光线可能会与其中一个相交，但这不意味着这个节点就是最近的相交点</i>）。因此，每个<code>ray-primitive intersection</code>只是一个候选节点，要确定实际最近的相交点，必须识别出所有的候选点。幸运的是，<code>BVH</code>树可以使用平衡节点实现，并且具有可预测的内存使用情况。出于这个原因，我们选择使用<code>BVH</code>树，并且它在现实中被广泛应用，正如<code>OptiX</code>所见。</p>
<p><code>NVIDIA RT Core</code>密切遵循<code>while-while</code>算法。它具备一个<code>traversal unit</code>遍历单元（包含<code>Box intersection Evaluators</code>包围盒相交评估器）和一个<code>intersection unit</code>相交单元（包含<code>Triangle intersection Evaluators</code>原始物体相交评估器）。<code>RT Core</code>首先从<code>SM</code>进行光线查询并触发遍历过程。<code>RT Core</code>从内存提取并解码<code>BVH</code>节点，并反复执行适当的相交测试，直到找到最近的相交点或者确认光线未与任何物体相交。然后将结果返回给<code>SM</code>进行后续处理和着色。</p>
<h3 id="Accelerating-Ray-Tracing"><a href="#Accelerating-Ray-Tracing" class="headerlink" title="Accelerating Ray Tracing"></a>Accelerating Ray Tracing</h3><p>反射光线通常是不一致的，因为他们在随机方向上反射。他们访问<code>AS</code>中的不同节点和部分，导致内存分散和<code>GPU</code>上低<code>SIMT</code>效率。以前的研究尝试把这些光线组织成更有条理的数据集合；然而他们并没有解决高内存和计算延迟问题，这是低效率的主要原因。我们的解决方案是跳过相似光线的<code>AS</code>遍历以降低总延迟，同时还可以将这些技术结合起来解决分散问题。</p>
<p>我们的预测器类似于<code>virtual address translation</code>虚拟地址转换和<code>page-table walking</code>页表遍历。光线遍历<code>AS</code>的过程和<strong>地址转换遍历页表<sup>1</sup></strong>的方式类似。具体来说，存储之前光线遍历结果的<code>predictor table</code>预测器表，类似于存储之前虚拟地址到物理地址转换的<strong><code>TLB</code><sup>2</sup></strong>。<code>pointer cache</code>指针缓存类似地存储了<strong>指针解引用<sup>3</sup></strong>。然而，与<code>TLB</code>和<code>pointer cache</code>不同的是，我们不会再次遇到一个完全相同的光线，因此除了进行预测外，我们无法复用存储的结果。数百万个光线中的每一个光线可能都是完全独立的，而我们的哈希方案试图在相似的光线中建立冲突，就像<code>constructing aliasing</code>一样。当成功预测相似光线的相交点时，我们跳过该光线的其余遍历部分，以此减少内存访问和计算量。</p>
<p><strong><em>Notes:</em></strong></p>
<ol>
<li>“地址转换遍历页表”：地址转换是指将虚拟地址（通常由程序生成）转换为物理地址（对应于实际内存中的位置）。这种转换通常涉及到一个称为页表的数据结构，它将虚拟页与物理页进行映射。</li>
<li>“TLB”: <code>Translation Looksaside Buffer</code>，转译后备缓冲，用于加速虚拟地址到物理地址的转换过程。它是一个高速缓存，存储了最近使用的虚拟地址到物理地址的映射。当程序访问某个虚拟地址时，会先查看<code>TLB</code>确认是否已存在该虚拟地址的映射信息。如果存在，就直接获取对应的物理地址从而加速访问；不存在，就从页表中获取映射信息，并存入<code>TLB</code>，以便加速未来的访问。</li>
<li>“指针缓存”是一种优化机制，目标是加快内存中特定位置的多次访问。当程序多次访问同一个指针所指向的地址时，解引用过程（或者指针所指向的实际值或对象）可能会成为性能瓶颈，因为它设计内存访问和数据传输。指针缓存会存储之前解引用过的指针及其对应的值，以便在下次访问相同指针的时候可以直接从缓存中获取，避免了再次解引用和内存访问。</li>
</ol>
<h2 id="RAY-INTERSRCTION-PREDICTOR-ALGORITHM"><a href="#RAY-INTERSRCTION-PREDICTOR-ALGORITHM" class="headerlink" title="RAY INTERSRCTION PREDICTOR ALGORITHM"></a>RAY INTERSRCTION PREDICTOR ALGORITHM</h2><p>在本节中，我们将对光线相交预测其算法进行抽象描述，并说明它如何跳过遍历大部分<code>BVH</code>内部节点的过程。</p>
<p><img src="Figure4.png" alt=""></p>
<p>如<code>Figure 4</code>所示，在光线开始遍历<code>BVH</code>之前，我们首先计算它的<code>hash</code>值并在预测器表中查找。如果存在一个与哈希值对应的条目，将返回一个包含一个或多个预测节点的预测结果，以供进一步评估。光线从这些预测结果里的节点们开始遍历<code>BVH</code>，直到找出一个相交点。如果找到相交点，遍历完成，内部节点被成功跳过。否则，我们无法确定光线是否未与场景相交，或者仅仅是使用预测器时未能找到相交点。这种情况下，光线必须从根节点开始执行完整的遍历，就像没有预测器一样。如果找到一个相交点，预测其表更新对应的节点。我们可以预测内部节点和叶节点，详见4.3节。</p>
<p>首先，我们为预测器定义一些术语。光线<code>hits</code>击中表示它与场景相交，无关是否使用预测器。只有光线<code>hit</code>时才可能跳过<code>BVH</code>节点。光线<code>predicted</code>被预测是指在预测器表中找到了一项预测，光线<code>verified</code>被验证是指光线使用预测找到了交点，而<code>mispredicted</code>被误预测是指光线被预测了但没有被验证。一个好的预测器应该能够验证许多光线，但被验证光线的比例受到被预测和击中光线比例的限制。</p>
<p>我们通过以下方式估算预测器跳过的<code>BVH</code>节点数量。设<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container>和<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.097ex" height="1.027ex" role="img" focusable="false" viewBox="0 -443 485 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g></g></g></svg></mjx-container>分别是给定渲染中<code>predicted</code>和<code>verified</code>所有光线的百分比。另外，一个光线在完整遍历过程中平均需要获取<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点，从预测其条目中评估<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container>个预测，并且每个预测遍历时需要获取<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点。我们分为以下三种情况：</p>
<ol>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.68ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3836.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1111.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2111.4,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(2614.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(3003.4,0)"><path data-c="25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></g></g></g></svg></mjx-container> 的光线未被预测，需要遍历<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点。</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.127ex;" xmlns="http://www.w3.org/2000/svg" width="2.982ex" height="1.824ex" role="img" focusable="false" viewBox="0 -750 1318 806"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(485,0)"><path data-c="25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></g></g></g></svg></mjx-container>的光线被验证，需要遍历<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="5.302ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 2343.4 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(743.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1465.4,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点。</li>
<li><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.646ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3821.4 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(1114.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2114.4,0)"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mo" transform="translate(2599.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(2988.4,0)"><path data-c="25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></g></g></g></svg></mjx-container> 的光线未被误预测，需要遍历预测节点和完整遍历<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点，总共需要遍历<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="9.425ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 4165.9 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(822.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1822.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(2565.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(3287.9,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>个节点。</li>
</ol>
<p>综上，平均一个光线需要遍历的节点数<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g></svg></mjx-container>可以被估算为：</p>
<script type="math/tex; mode=display">\begin{aligned}
N &= (1-p)n + vkm + (p-v)(km+n)\\
&= n - pn + vkm + pkm + pn - vkm - vn\\
&= n + pkm - vn
\end{aligned}</script><p>因此，跳过的节点数量为：</p>
<script type="math/tex; mode=display">
n - N = vn - pkm \tag{1}</script><p><code>Equation 1</code>展示了一个直观的结果，即跳过的节点数等于被验证光线减去评估预测节点的开销。因此，跳过的节点数通过具有较高的验证率<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.097ex" height="1.027ex" role="img" focusable="false" viewBox="0 -443 485 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g></g></g></svg></mjx-container>而增加，而通过过度预测（增加<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.138ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 503 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g></g></g></svg></mjx-container>）或对于预测结果遍历更多节点（增加<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.179ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 521 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></svg></mjx-container>或者<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>）而减少。我们将在下一节中探讨这些权衡。</p>
<h2 id="PROPOSED-ARCHITECTURE"><a href="#PROPOSED-ARCHITECTURE" class="headerlink" title="PROPOSED ARCHITECTURE"></a>PROPOSED ARCHITECTURE</h2><p>本节概述了预测光线交点所面临的挑战，以及我们提出的硬件预测器是如何克服他们的。我们描述了<code>predictor table architecture</code>预测器表的架构和<code>hashing schemes</code>哈希方案，然后讨论了如何通过<code>Go Up Level</code>支持预测内部节点。由于预测器的误预测可能会导致遍历算法的分歧/分散，因为我们还讨论了如何通过<code>warp repacking</code>来减轻这种影响。</p>
<h3 id="Predictor-Table-Architecture"><a href="#Predictor-Table-Architecture" class="headerlink" title="Predictor Table Architecture"></a>Predictor Table Architecture</h3><p><img src="Figure5.png" alt=""></p>
<p>每个<code>SM</code>上都有一个预测器表，其结构如<code>Figure 5</code>所示，用于存储节点预测。<code>set-associative way</code><strong>关联组<sup>1</sup></strong>的每一行都是一个预测器条目，其中包含<code>valid bit</code>有效位，<code>ray hash tag</code>光线哈希标记，一个或多个用于存储预测节点（一个偏移量，指向<code>BVH</code>树缓冲区内的位置）的<code>slots</code>插槽。预测器包含了同一帧内之前遇到的光线的条目。鉴于经典的光线生成着色器使用伪随机数选择光线方向，同一帧中的两个不太可能完全相同。为了确定预测器表中的哪个条目适合当前的新光线，我们使用哈希算法进行标识。当访问预测器时，光线参数会被哈希处理，得到的哈希模式将用于预测器的查找。这个哈希模式被用来索引预测器表，并与选定的行中的<code>tag</code>进行比较。如果找到<code>tag</code>匹配，则认为该光线被预测，并返回相应的节点地址进行验证。正如前文提到，验证光线涉及从预测节点开始<code>BVH</code>树。在这个验证步骤中，使用完整精度的光线参数进行相交测试（而不是哈希值）。</p>
<p>根据哈希函数的不同，用于哈希的位数<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>可能大于用<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>位索引的表。在这种情况下，我们通过将<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>位哈希值分割成<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="6.484ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2866 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2308" d="M174 734Q178 746 190 750H298H369Q400 750 411 747T422 730T411 713T372 709Q365 709 345 709T310 710H214V-235Q206 -248 196 -250Q192 -250 189 -249T184 -247T180 -244T178 -241T176 -237T174 -234V734Z"></path></g><g data-mml-node="mi" transform="translate(444,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1044,0)"><g data-mml-node="mo"><path data-c="2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></g></g><g data-mml-node="mi" transform="translate(1544,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(2422,0)"><path data-c="2309" d="M21 717T21 730T32 746T75 750H147H256Q266 742 269 735V-235Q262 -248 251 -250Q247 -250 244 -249T239 -247T235 -244T233 -241T231 -237T229 -234V710H133Q119 710 99 710T71 709Q43 709 32 713Z"></path></g></g></g></svg></mjx-container>份，并使用<code>bitwise-xor</code>按位异或进行组合成<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>位，类似于<code>gshare branch predictor</code>。</p>
<p>虽然<code>Figure 5</code>中的光线相交预测器的结构在表面上看起来类似于缓存，但预测其表中存储的是地址，而不是节点数据。与<strong><code>BTB</code><sup>2</sup></strong>或者更复杂的<code>branch target predictor</code>分支目标预测器不同，光线相交预测器存储的地址是<code>BVH</code>树节点的地址，而不是指令的地址。与<code>TLB</code>不同，即使在光线相交预测其中包含光线相交节点的条目，光线的查找也不能保证会找到匹配的条目。</p>
<p>我们在第6节中比较了不同的预测器表参数，并发现使用一个4路组相联的预测器表，共有1024个条目，每个条目包含一个节点，标签使用15位时，表现最佳。正如<code>Equation 1</code>中所示，虽然增加每个条目中的节点数可以提高验证通过的光线数量，但每个光线也必须评估更多的节点。</p>
<p>当每个条目使用多个节点时，需要一个节点替换策略来清除条目中的预测。我们用27位来索引节点，这足以管理一棵具有<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.903ex" role="img" focusable="false" viewBox="0 -841 1290.1 841"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>个节点的<code>BVH</code>树（约134百万个）或者至少有6700万个<code>triangles</code>的场景（这个数字是在最坏情况下进行估算的，即一个完美的二叉树，每个叶子节点上只有一个<code>triangle</code>）。这个选择对于现代商业游戏来说是足够的，例如《使命召唤》每帧用了2400万个<code>triangles</code>。</p>
<p>由于每个<code>warp</code>中有32条光线，因此每个周期内可能有至多32个线程尝试对预测表进行查找或更新。保持32个访问端口到我们的预测器表是不现实的，所以我们为预测器查找维护了一个<code>FIFO</code>队列，并为预测器更新维护一个单独的队列。我们经实验法线用4个访问端口是理想的。内存系统不会被预测验证的突发请求淹没， 并且硬件区域受到合理的大小限制。即使在技术上可能实现32个访问端口，也不会提高性能。因为请求会在内存层次结构中形成瓶颈，预测器单元会保持空闲，直到下一个<code>warp</code>准备好进行访问。</p>
<h3 id="Hashing"><a href="#Hashing" class="headerlink" title="Hashing"></a>Hashing</h3><p>为了识别可以共享预测器条目的光线，我们探索了量化光线相似性的策略。直观地说，如果光线遍历了<code>BVH</code>的相似部分，这些光线就认为是相似的。离线光追的先前研究已经探索了如何通过对光线进行排序来提高缓存命中率。因为在遍历之前不能确定光线与哪些节点相交（即遍历到哪些节点），大多数光线排序技术将三维光线起点和二维光线方向组成排序键。我们相似地将光线的起点和方向编码为单个值，但不同于将其用于对光线进行排序，我们将其用于索引预测器表。我们的目标是对于相似光线，最大化预测器表的碰撞；对于不同光线，最小化预测器碰撞。我们评估了两种不同的哈希函数。</p>
<p><img src="Figure6.png" alt=""></p>
<h4 id="Grid-Spherical"><a href="#Grid-Spherical" class="headerlink" title="Grid Spherical"></a>Grid Spherical</h4><p><code>Figure 6a</code>展示了<code>Grid Spherical</code>哈希函数。这个哈希函数将光线的起点和方向分别在笛卡尔坐标系和<strong>球面坐标系<sup>3</sup></strong>中进行了量化，然后将他们进行了组合。光线的起点分量x, y, z 分别使用<code>scene bounding box</code>场景包围盒将其映射到整数范围<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5.925ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2618.9 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msup" transform="translate(1222.7,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2229.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>，其中场景包围盒由两个<code>extreme corners</code>表示。然后，这些值被连接成单一值。我们将其称为<code>Grid Hash block</code>。相似的，光线的方向分量<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.867ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4803.2 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g><g data-mml-node="mo" transform="translate(746.8,0)"><path data-c="2208" d="M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z"></path></g><g data-mml-node="mo" transform="translate(1691.6,0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(1969.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(2469.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(2914.2,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(4414.2,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>,<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="11.154ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4930.2 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D719" d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"></path></g><g data-mml-node="mo" transform="translate(873.8,0)"><path data-c="2208" d="M84 250Q84 372 166 450T360 539Q361 539 377 539T419 540T469 540H568Q583 532 583 520Q583 511 570 501L466 500Q355 499 329 494Q280 482 242 458T183 409T147 354T129 306T124 272V270H568Q583 262 583 250T568 230H124V228Q124 207 134 177T167 112T231 48T328 7Q355 1 466 0H570Q583 -10 583 -20Q583 -32 568 -40H471Q464 -40 446 -40T417 -41Q262 -41 172 45Q84 127 84 250Z"></path></g><g data-mml-node="mo" transform="translate(1818.6,0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(2096.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(2596.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(3041.2,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(4541.2,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>通过将他们离散化为整数，并从整数<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex;" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container>中提取前<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>位，从整数<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.348ex" height="2.034ex" role="img" focusable="false" viewBox="0 -694 596 899"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D719" d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"></path></g></g></g></svg></mjx-container>中提取出<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="5.883ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2600.4 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1100.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2100.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container>位，然后进行连接。这两个数用<code>bitwise-xor</code>进行组合。选择<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>（用于起点的位数）和<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>（用于方向的位数）可以调整哈希函数的散列程度。换言之，使用更多的位数可以使得更少的光线被映射到同一个条目中。</p>
<h4 id="Two-point"><a href="#Two-point" class="headerlink" title="Two point"></a>Two point</h4><p><code>Figure 6b</code>展示了<code>Two Point</code>哈希函数。该哈希函数基于<code>Two point</code>排序方法，它将光线的起点和一个估计的目标交点结合起来。光线的起点使用与<code>Grid Spherical</code>相同的方法进行哈希。估计的目标交点用<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="13.837ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 6115.9 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(638.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(1694.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mo" transform="translate(2401.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(3402,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4075.2,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(4575.4,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mo" transform="translate(5095.7,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(5595.9,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container>来计算，其中<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g></g></g></svg></mjx-container>是目标点，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.097ex" height="1.023ex" role="img" focusable="false" viewBox="0 -441 485 452"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g></g></g></svg></mjx-container>是起点，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex;" xmlns="http://www.w3.org/2000/svg" width="1.176ex" height="1.593ex" role="img" focusable="false" viewBox="0 -694 520 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container>是归一化后的方向，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="0.674ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 298 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></svg></mjx-container>是场景包围盒的最大长度，<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.02ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 451 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container>是一个可以选择的固定的预估长度比。然后这个估计的目标点通过<code>Grid Hash block</code>进行哈希，并与哈希过的起点进行<code>xor</code>操作。</p>
<p>我们发现使用<code>Grid Spherical</code>哈希函数比使用<code>Two point</code>哈希函数产生稍微更好的结果。我们使用一个5位的起点位和一个3位的方向位，得到一个15位的光线哈希。</p>
<p>上述的两个哈希函数是通过实验验证来进行选择的可能并未达到最优。我们将探索其他哈希函数，以及更复杂的哈希技术，例如组合多个哈希函数或者自适应的选择使用的位数，留给未来的工作。</p>
<h3 id="Go-Up-Level"><a href="#Go-Up-Level" class="headerlink" title="Go Up Level"></a>Go Up Level</h3><p><img src="Figure7.png" alt=""></p>
<p>即使是非常相似的光线，也可能与不同的<code>primitives</code>原始物体相交。我们观察到这些光线通常会与不同的叶子节点相交，但会与这些叶子节点的相似祖先节点相交。在此启发下，我们引入了<code>Go Up Level</code>：不预测叶子节点，而是预测覆盖更大空间的内部节点。我们将<code>Go Up Level</code>定义为与相交的<code>primitives</code>所在的叶子节点相对应的<code>BVH Level</code>。换言之，当<code>Go Up Level</code>为<code>k</code>时，叶子结点的第<code>k</code>个祖先节点被存储在预测表中，以便用于未来光线的预测。具体来说，当<code>Go Up Level</code>为0时，预测的是叶子节点本身；而对于<code>Go Up Level</code>为1或2时，预测的分别是父节点和祖父节点，如<code>Figure 7</code>所示。</p>
<p>随着<code>Go Up Level</code>的增加，验证光线的概率增加，因为略有不同的叶子节点可以共享同一个祖先节点。然而，这样一来，对于每个预测，光线都需要遍历更大的<code>BVH</code>区域来验证预测并找到交点。这在<code>Equation 1</code>中呈现出权衡；增加<code>Go Up Level</code>会增加<code>v</code>，也会增加<code>m</code>。我们发现<code>Go Up Level</code>为3的时候最有效。详见6.2.1小节。</p>
<p><img src="Figure8.png" alt=""></p>
<p>为了实现<code>Go Up Level</code>，叶子节点需要跟踪祖先节点，但是大多数<code>BVH</code>节点不存储父节点指针。或者，我们可以使用额外的栈内存来在遍历树时跟踪节点。由于我们使用的是<code>Aila and Laine BVH tree</code>，可以在构建<code>BVH</code>时预先计算每个节点的第<code>k</code>个祖先，而无需使用额外的栈内存或产生额外的内存访问，并将其存储在空的<code>padded space</code>中。<code>Figure 8</code>显示了<code>Aila and Laine node</code>的结构。这样，可以在节点访问时，可以同时获取祖先节点索引和子节点索引。</p>
<h3 id="Warp-Repacking"><a href="#Warp-Repacking" class="headerlink" title="Warp Repacking"></a>Warp Repacking</h3><p>简单地实现预测器会导致<code>SIMD</code>执行中的不一致。因此，我们提出在预测之后对<code>warps</code>进行重组，以防止<code>misprediction</code>错误预测延迟整个<code>warp</code>的进度。与过去的<code>warp</code>重组方法不同，这种重组是在<code>accelerator unit</code><strong>加速器单元<sup>4</sup></strong>内部进行的，即在每个<code>warp</code>的单个复杂指令集执行期间进行，这可以避免影响其他硬件结构，如寄存器文件。</p>
<p><img src="Figure9.png" alt=""></p>
<p>一个<code>warp</code>的执行时间取决于它的最慢线程。对于一个包含32个线程（32个光线）的<code>warp</code>，很可能至少有一个光线发生预测错误，这个光线需要执行完整的遍历和评估预测结果。<code>Figure 9</code>展示了一个包含8个光线的<code>warp</code>示例。这些光线在进行了预测表查询之后，从<code>Figure 7</code>中的<code>'BVH</code>树上进行遍历。预测可能包含带有一个或者多个<code>primitives</code>的叶子节点。线程5发生了预测错误，在执行常规的<code>BVH</code>遍历之前，对预测的<code>primitives</code>进行了相交测试。预测错误的光线需要访问的节点数比没有预测器的情况下要多，引入了<code>long tail</code>问题且演唱了<code>warp</code>的执行时间。其他的所有线程必须等待线程5完成，然后<code>warp</code>才能完成。在最后的遍历阶段，<code>SIMT</code>效率也会显著降低，因为只有发生预测错误的光线（线程5）还在执行。</p>
<p>有三种可能的结果：交点被正确预测（线程1、4、7、8），错误预测（线程5），根本没被预测（线程2、3、6）。理想情况下，我们应该将所有正确预测的光线放在一起，这样慢速线程就不会延迟整个<code>warp</code>的进程。未被预测的光线也应该被分组，以便它们可以继续从<code>warp</code>内部的内存合并中受益（<i>减少内存访问的碎片化</i>）。最后，被错误预测的光线应该被单独维护，避免延长<code>warp</code>的遍历时间。</p>
<p>尽管我们在测试预测的<code>primitives</code>之前无法区分正确的预测和错误的预测，但我们发现仅仅将被预测的光线和未被预测的光线区分开来就足以纠正问题行为。对于<code>Figure 9</code>中的示例，我们应该使线程1、4、5、7、8一组，线程2、3、6一组。原始的<code>warp</code>不再是满的，但是剩余的线程仍然可以从<code>warp</code>内部的内存合并中受益，并且通常在类似的时间范围内完成遍历。这一步骤对于预测器提供性能优势是必要的。结果和没有<code>repacking</code>的预测器进行比较详见6.2.2节。</p>
<p><img src="Figure10.png" alt=""></p>
<h4 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h4><p>我们在<code>predictor unit</code>里进行<code>repacking</code>。在线程完成预测器查找之后，被预测的光线被从<code>warp</code>中移除，而未被预测的光线被保留。被预测的光线会被排队到<code>Figure 10</code>所示的<code>partial warp collector</code>中。该结构仅存储被预测的光线的ID，直到<code>collector</code>中填满32个光线或者达到超时时间，然后这些光线会被排队等待进行遍历（<i>组成新的<code>warp</code></i>）。 我们仅跟踪光线ID，因为与每条光线相关的其余数据存储在<code>ray buffer</code>中，由光线ID进行索引。<code>collector</code>的总大小占寄存器的0.2%，最多存储64个光线ID和一个5位的超时计数器。我们设置了短暂的超时时间，以确保在光线不足的时候能够及时处理。我们发现超时时间在5-30个<code>cycle</code>之间的取值没有明显的差异。我们允许最多存储64个光线ID，以便存储溢出的光线。例如，如果在超时之前，<code>collector</code>中有30个光线，在另一个<code>warp</code>添加了15个光线之后，<code>collector</code>中会有45个光线，直到有32个光线被移除并排队等待遍历。</p>
<p>在<code>repacking</code>的过程中，光线ID被移动在用于跟踪<code>RT unit</code>内<code>warp</code>进度的缓冲区之间。因为每个线程只跟踪一个光线，大部分关联数据已存储在5.1.1中描述的<code>ray buffer</code>中。在基准<code>RT unit</code>这个上下文中，重新打包这个步骤仅仅更新了线程索引到<code>ray buffer</code>中，同时避开了与寄存器文件对齐的复杂限制。其他的<code>warp</code>重组方法，例如<code>Dynamic Warp Formation</code>，<code>Thread Block Compaction</code>，<code>Large Warps</code>要求线程在洗牌到不同<code>warp</code>之后仍然保持在其各自的<code>lane</code>中，但对于这里提出的预测器而言，是不必要的。预测器<code>repacking</code>的过程仅在<code>RT unit</code>内持续存在，因此在后续的指令中不需要移动架构可见的寄存器值（<i><code>repacking</code>只在<code>RT unit</code>内部进行，不必考虑对整个架构的影响</i>）。我们假设线程在遍历过程中是随意组合成<code>warp</code>的，这种组合不会影响未来的着色指令，因为所有的结果都是基于ID存储的。</p>
<h4 id="Additional-Warps"><a href="#Additional-Warps" class="headerlink" title="Additional Warps"></a>Additional Warps</h4><p>由于<code>repacking</code>之后，<code>warp</code>的利用率降低，因此应该有足够的资源来支撑光追单元中<code>additional warp</code>额外的线程束。我们可以增加同时执行的<code>warp</code>的数量限制。为了确保<code>RT unit</code>不被压垮，在<code>RT unit</code>满的时候，只有新创建的<code>warp</code>才能继续派遣（<i>因为<code>repacking</code>后的<code>warp</code>已经解决了<code>long tail</code>问题，具有更低概率使线程束被拖延，选择新创建的<code>warp</code>可以保持光追单元的高效利用</i>）。只要有超过32个<code>ray buffer slots</code>可用，就可以调度一个新创建的<code>warp</code>。虽然这不像<code>repacking</code>这一步那样重要，但额外增加<code>warp</code>的好处详见6.2.2节。</p>
<h3 id="Hardware-Implementation"><a href="#Hardware-Implementation" class="headerlink" title="Hardware Implementation"></a>Hardware Implementation</h3><p><code>Figure 10</code>总结了基准<code>RT unit</code>（将在5.1中详细介绍），并增加了预测器。<code>ray buffer</code>光线缓冲区存储了光线ID，光线属性，光线状态（当前遍历阶段）等信息，用于存储<code>RT unit</code>中的光线。为每个光线分配一个<code>Traversal Stack</code>来跟踪下一步访问。任何新的光线都将被调度执行一个基于光线属性计算的哈希的预测器表查找。如果查找成功并得到一个预测结果，预测节点将被送到光线遍历栈的栈顶。否则，光线就按照正常流程进行遍历（<i>从<code>root</code>开始遍历</i>）。</p>
<p><strong><em>Notes:</em></strong></p>
<ol>
<li>“关联组”是一种缓存中管理数据的方式。在这种映射方式下，缓存被划分为多个<code>set</code>组，每个组包含多个<code>cache lines</code>缓存行。每个缓存行可以存储一个数据块。</li>
<li>“BTB”: Branch Target Buffer, 一种高速缓存。它用于存储分支指令的目标地址，以便在程序执行时更快的预测和处理分支操作。<code>BTB</code>通常与分支目标预测其一起使用，分支目标预测器会尝试预测分支指令的下一条指令是否会被执行，以便提前加载相关的指令和数据。</li>
<li>“球面坐标系”：Spherical Coordinate System，一种用来描述三维空间中点的坐标系统，它使用两个角度和一个距离来确定一个点的位置。<ul>
<li>极径（r）：表示点与坐标原点（通常是球心）之间的距离。</li>
<li>极角（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.023ex;" xmlns="http://www.w3.org/2000/svg" width="1.061ex" height="1.618ex" role="img" focusable="false" viewBox="0 -705 469 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g></g></g></svg></mjx-container>）：是从正上方（z轴正方向）向下测量的角度，范围通常为<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.04ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3111.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(2722.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>。</li>
<li>方位角（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.348ex" height="2.034ex" role="img" focusable="false" viewBox="0 -694 596 899"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D719" d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z"></path></g></g></g></svg></mjx-container>）：是从某个参考方向（通常是x轴正方向） 开始逆时针测量的角度，范围通常为<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.04ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3111.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(2722.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>。</li>
</ul>
</li>
<li>“加速器单元” ：Accelerator unit，它是一种硬件组件，旨在通过专门优化的电路和指令集来执行特定类型的任务，以提高计算性能。</li>
</ol>
<h2 id="METHODOLOGY"><a href="#METHODOLOGY" class="headerlink" title="METHODOLOGY"></a>METHODOLOGY</h2><p>本节描述了用于光线交点预测器的模拟器和模拟设置。我们对<code>GPUPU-Sim 4.0.1</code>进行拓展，以模拟类似<code>NVIDIA's RT Core</code>，作为我们的baseline，如5.1节所述。我们没有模拟完整的图形流水线，因为我们的预测器只涉及光追部分。在混合渲染中，光追<code>AO</code>通常在传统的光栅化之后进行，并使用混合技术进行合并。5.2节中描述了光追的benchmark，光线生成过程，以及模拟器配置。</p>
<p>对于<code>energy analysis</code>，我们使用<code>GPUWattch</code>来估算<code>GPU</code>中的能量变化，包括<code>cache</code>和<code>DRAM</code>访问。我们使用<code>CACTI7</code>来模拟其余主要组件，该工具使用<code>45nm process</code>。<code>Figure 10</code>中的<code>predictor table</code>预测器表，<code>traversal stacks</code>遍历栈，<code>ray buffer</code>光线缓冲区，<code>partial warp collector</code>都被建模为<strong><code>SRAMs</code><sup>1</sup></strong>，其开销是根据<code>access energy</code>进行保守估计的。<code>warp repacking</code>的<code>energy</code>包含<code>partial warp collector</code>和 <code>additional accesses to the ray buffer</code>。我们保守地估算<code>intersection units</code>，将其视为加法器和乘法器，并假设所有其他控制元素的能量开销较小。</p>
<h3 id="Ray-Tracing-Unit"><a href="#Ray-Tracing-Unit" class="headerlink" title="Ray Tracing Unit"></a>Ray Tracing Unit</h3><p>“magic”指令被认为是实现效能计算的解决方案，它可以执行数百个操作并与自定义存储单元进行交互。在光追背景下，整个<code>traversal and intersection</code>遍历和相交过程会被视为一个单一的<code>__traceray()</code>指令，就像<code>NVIDIA RT Core</code>的<code>Ray Query</code>一样。对于我们的baseline architecture，我们模拟了一个<code>RT unit</code>光追单元，包含一个<code>traversal block</code>和类似于<code>NVIDIA RT Core</code>的<code>ray-triangle intersection block</code>。<code>RT unit</code>通过特殊的<code>__traceray()</code>指令进行访问，该指令传递所有必要的光线数据和<code>AS</code>的根节点。这个指令会被从正常的<code>GPU</code>执行中截取，然后被重定向到<code>RT unit</code>中执行，并且结果被写回<code>GPU</code>。<i>这样就可以使得光追操作在专门的RT单元中执行，而不是正常的<code>GPU</code>中执行。</i></p>
<p><code>RT unit</code>被设置为一个具有<strong>可变延迟的函数单元<sup>2</sup></strong>，类似<code>GPU</code>中得<strong>LDST unit<sup>3</sup></strong>加载存储单元。对于<code>Algorithm 1</code>的每次迭代，<code>RT unit</code>会获取相关的包围体或者<code>primitives</code>。RT单元和LDST单元<strong>复用<sup>4</sup></strong>，用于访问<code>L1 cache</code>和其余的内存层次结构。</p>
<h4 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h4><p>我们的<code>CUDA</code>光追内核的每个线程追踪一条光线。光线数据通过线程ID进行检索，包括起点、方向和定义光线长度的参数<code>t</code>。这些数据以及<code>BVH</code>的根节点被传递到<code>RT unit</code>中，用于每个线程。<code>RT unit</code>将数据存储到<code>ray buffer</code>中，由光线ID索引，同时通过控制器中的计数器来跟踪<code>warp</code>的完成情况。<code>RT unit</code>同时执行至多8个<code>warp</code>，因此<code>ray buffer</code>中最多存储<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="11.941ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 5278 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(1222.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1944.4,0)"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g><g data-mml-node="mo" transform="translate(2722.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(3778,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1000,0)"></path></g></g></g></svg></mjx-container>条光线。</p>
<h4 id="Traversal-Unit"><a href="#Traversal-Unit" class="headerlink" title="Traversal Unit"></a>Traversal Unit</h4><p>每次接收到新的<code>__traceray()</code>命令时，都会触发控制器初始化一个遍历栈。我们将遍历栈配置为最多可以容纳8个条目，这对于许多遍历都足够了，偶尔会溢出到线程本地内存中。遍历从根节点开始，然后对<code>BVH</code>进行深搜，将未访问的节点推入遍历栈。</p>
<p>在<code>RT unit</code>中可能同时存在多个<code>warps</code>，因此内存调度器必须在调度内存请求时选择优先考虑哪一个。受到<code>greedy-then-oldest</code>调度策略的启发，我们优先考虑一个给定的<code>warp</code>，直到这个<code>warp</code>中所有的线程都在等待内存请求后再考虑下一个<code>warp</code>。内存调度器首先选择一个<code>warp</code>，然后使用一个<code>FIFO</code>队列来选择下一个要访问的节点。如果同一个<code>warp</code>中的不同光线需要访问相同的节点，那么这些相同节点会被合并成一个单独的内存请求，类似于<code>MSHR</code>多级缓存命中缓冲区的工作方式。这在遍历过程的早期特别重要，因为大多数光线都会访问相同的节点（例如根节点）。在每次迭代中，接下来的节点从遍历栈中弹出，按照线程顺序从<code>L1 cache</code>中请求，并在<code>ray buffer</code>中找到对应的光线进行计算。</p>
<p>数据返回时（<i>从内存中拿到节点数据时</i>），节点会被广播到光线缓冲区。任何匹配的条目（<i>因为之前不同光线请求相同节点时合并了，要让这些光线都得到节点数据</i>）都会触发相交测试，光线和节点数据会被传到<code>intersection unit</code>里进行计算。控制器会根据相交测试的结果更新光线的状态和<code>warp</code>追踪计数器。当这些计数器显示一个<code>warp</code>已经完成计算时，控制器会释放遍历栈并发出<code>warp</code>完成信号。</p>
<h4 id="Intersection-Unit"><a href="#Intersection-Unit" class="headerlink" title="Intersection Unit"></a>Intersection Unit</h4><p><code>Intersection unit</code>加速了两种类型的相交测试，即遍历<code>BVH</code>节点时的<code>ray-box test</code>和到达叶子节点后的<code>ray-triangle test</code>。我们的模型基于<code>T&amp;I engine</code>的遍历和相交单元，使用了一个两阶段流水线化的<code>ray triangle test</code>和一组简单的加法器、乘法器和比较器用于<code>ray-box test</code>。每种测试类型都有32个流水线硬件单元，以便一个线程束中所有32个线程可以并行计算光线相交。由于内存调度器每次只处理一个线程束的请求，因此不需要（<i>为多个线程束建立</i>）输入队列。在每个周期中，光线和节点数据被转发，控制器会根据数据类型通知对应的相交单元执行计算。一旦流水线相交测试完成，输出通过<code>ray buffer</code>返回，控制器相应地更新光线状态。如果需要，下一个节点将被推入遍历栈。</p>
<h4 id="Memory-Interface"><a href="#Memory-Interface" class="headerlink" title="Memory Interface"></a>Memory Interface</h4><p>来自<code>RT unit</code>的内存请求被发送到<code>L1 cache</code>，然后连接到剩余的内存层次结构。由于通常没有其他竞争的指令，<code>L1 cache</code>通常足够管理光追的内存请求。我们使用了一个<code>64kb</code>的<code>L1 cache</code>，并在6.2.3中讨论了其他可能的配置，比如专用的<code>RT cache</code>。</p>
<h4 id="Latency"><a href="#Latency" class="headerlink" title="Latency"></a>Latency</h4><p><code>RT unit</code>中的每个元素都会对整体遍历延时产生影响。最小的遍历延时需要一个周期用于排队，两个周期用于访问表，一个周期用于访问<code>L1 cache</code>，以及两个周期用于相交测试。这个延迟会因为预测结果、遍历长度以及内存访问延迟而不同。详见6.2.4。</p>
<h4 id="Correlation"><a href="#Correlation" class="headerlink" title="Correlation"></a>Correlation</h4><p>尽管<code>RT unit</code>具有类似<code>NVIDIA RT Core</code>的遍历单元和相交单元，但是我们无法确认相似之处。关键因素，如多个光线在<code>NVIDIA RT Core</code>中如何共存，内存请求如何调度以及如何维护光线数据，<code>NVIDIA</code>并未透露。因此，我们并不试图完全模拟<code>RT Core</code>，而是做一个类似的，泛化的<code>RT unit</code>。</p>
<p><img src="Table1.png" alt=""></p>
<p>我们在<code>RT unit</code>上模拟了一些常见的benchmark场景中的主光线和反射光线，这些场景在<code>Table 1</code>中。</p>
<p><img src="Figure11.png" alt=""></p>
<p>我们将这与<code>NVIDIA RTX 2080Ti GPU</code>上的基本<code>Vulkan</code>实现进行了比较，该实现也涉及主光线和反射光线。我们对比了具有类似光线数量的相同基准场景。<code>Figure 11</code>显示了这两者之间的光线/秒的相关性。</p>
<p>我们使相关系数高达0.9，但测试样本小，而且这两种方法并不完全相同。我们将我们的基准与高端的<code>NVIDIA GPU</code>进行了验证，因为这是目前唯一具有光追功能的消费级GPU。然而，我们的设计针对的是移动GPU，目标是加速在更具挑战的移动环境中的光追。</p>
<h3 id="Simulation"><a href="#Simulation" class="headerlink" title="Simulation"></a>Simulation</h3><p>基于基准的<code>RT unit</code>，我们对提出的光线相交预测器进行建模，并通过将结果与基准进行比较来评估其有效性。我们选择了7个常见的场景作为benchmarks，在<code>Table 1</code>中展示。每个场景生成约四百万个<code>AO</code>光线，方法是首先为<code>1024*1024</code>的<code>viewport</code>中的每个像素计算主射线击中点，然后通过对击中点周围的上半球进行随机余弦采样，为每个击中点创建4个<code>AO</code>光线。这些光线的长度是场景包围盒对角线长度的25%-40%，以表示可能阻挡环境光的附近区域。我们通过使用<code>Aila and Laine Morton</code>顺序快速排序算法对光线进行排序，比较光线排序的效果。我们在<code>GPGPU-sim</code>中模拟了这些光线，使用<code>RT unit</code>和预测器进行交点测试。</p>
<p><img src="Table2.png" alt=""><br><img src="Table3.png" alt=""></p>
<p><code>Table 2</code>概述了<code>GPGPU-Sim</code>的<code>GPU</code>配置，<code>Table 3</code>列出了我们模拟的预测器的设置。</p>
<p><strong><em>Notes:</em></strong></p>
<ol>
<li>“SRAMs”：Static Random-Access Memories。静态随机存取存储器是一种常见的存储器类型，用于存储数据和指令。与<code>DRAM</code>不同，<code>SRAM</code>是一种易失性存储器，这意味着在断电时会丢失存储信息。<code>SRAM</code>具有快速的读写速度和较低的访问延迟，这使其在需要快速访问的应用中得到广泛应用。</li>
<li>可变延迟函数单元是指其执行时间可能因为不同操作而有所不同。</li>
<li>“LDST”: Load and Store unit，即加载和存储操作。这里是指GPU从内存加载数据（Load）或者将数据存储回内存（store）的操作。</li>
<li>“复用”：不同的情景或任务之间共享使用同一资源、部件或设备的过程。</li>
</ol>
<h2 id="RESULTS"><a href="#RESULTS" class="headerlink" title="RESULTS"></a>RESULTS</h2><p><i>Skipping this section…</i></p>
<h2 id="RELATED-WORKS"><a href="#RELATED-WORKS" class="headerlink" title="RELATED WORKS"></a>RELATED WORKS</h2><p><i>Skipping this section…</i></p>
<h2 id="CONCLUSION"><a href="#CONCLUSION" class="headerlink" title="CONCLUSION"></a>CONCLUSION</h2><p>在本文中，我们提出了一种光线相交预测器，用于加速光追<code>AO</code>计算。通过在预测器表中存储光线哈希以及对应的光线相交结果的历史记录，我们可以跳过未来光线的<code>BVH</code>遍历。朴素地实现预测器会导致预测器在<code>SIMD</code>中执行的不一致性，因此在预测之后对<code>warp</code>进行<code>repacking</code>，将被预测的光线分开。模拟结果表明，预测器相较于基准<code>RT unit</code>平均实现了<code>26%</code>的加速，并将内存访问减少了<code>13%</code>。</p>
<p>在光线相交预测方面仍有很多令人兴奋的方向可以探索。我们提出的<code>limit study</code>表明，更好的预测器结构可能会有改进空间。此外，在本文中，我们主要关注了<code>AO</code>，它是许多受益于光追的照明效果之一。虽然我们呈现了将预测其拓展到全局光照计算的结果，该计算需要最近的相交点，但还有很多进步空间。探索预测器在动态场景和动画中的应用也可能是一个引人注目的方向。预测器状态可能在帧之间被保留，并且仅对动态元素重新训练预测器。</p>
<h2 id="REFERENCES"><a href="#REFERENCES" class="headerlink" title="REFERENCES"></a>REFERENCES</h2><ul>
<li><a target="_blank" rel="noopener" href="https://people.ece.ubc.ca/~aamodt/publications/papers/liu.micro2021.pdf">Intersection Prediction for Accelerated GPU Ray Tracing</a></li>
<li><a target="_blank" rel="noopener" href="https://raytracing.github.io/books/RayTracingInOneWeekend.html">Ray Tracing in One Weekend</a></li>
</ul>
</div><div class="tags"><a href="/tags/#Architecture"><i class="fa fa-tag">Architecture</i></a><a href="/tags/#Graphics"><i class="fa fa-tag">Graphics</i></a></div><div class="post-nav"><a class="pre" href="/2023/07/25/Ray-Tracing-in-One-Weekend-2/">Ray Tracing in One Weekend - 2</a><a class="next" href="/2023/07/21/Paper-Reading-0/">Paper Reading 0 - How to read research papers?</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CS/">CS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/English/">English</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Summary/">Summary</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/06/17/Leetcode-3405-Count-the-Number-of-Arrays-with-K-matching-Adjacent-Elements/">Leetcode-3405-Count-the-Number-of-Arrays-with-K-matching-Adjacent-Elements</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/06/15/Leetcode-3123-Find-Edges-in-Shortest-Paths/">Leetcode-3123-Find-Edges-in-Shortest-Paths</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/21/Literature-Review-for-Ray-Tracing/">Literature Review for Ray Tracing</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/14/Docker-Usage/">Docker Usage</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/07/Vulkan-Sim-Experiment/">Vulkan-Sim Experiment</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/02/Leetcode-887-Egg-Drop/">Leetcode 887-Egg Drop</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/12/Course-Review-AI-Problem-sloving-by-searching/">Course Review AI - Problem sloving by searching</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/09/Paper-Reading-2/">Paper Reading 2 - Vulkan-Sim:A GPU Archtecture Simulator for Ray Tracing</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/05/Install-GPGPU-Sim/">Install GPGPU-Sim</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/08/21/Install-Ubuntu/">Install Ubuntu</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://www.haomwei.com/technology/maupassant-hexo.html#%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE" title="Maupassant Config" target="_blank">Maupassant Config</a><ul></ul><a href="https://hexo.io/docs/configuration.html" title="Hexo Docs" target="_blank">Hexo Docs</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Quanzw's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>